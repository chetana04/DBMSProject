DROP TABLE IF EXISTS movies.movie_crew;

CREATE TABLE movies.movie_crew (
  movie_id INT DEFAULT NULL,
  person_id INT DEFAULT NULL,
  department_id INT DEFAULT NULL,
  job VARCHAR(200) DEFAULT NULL,
  CONSTRAINT fk_mcr_dept FOREIGN KEY (department_id) REFERENCES movies.department (department_id),
  CONSTRAINT fk_mcr_movie FOREIGN KEY (movie_id) REFERENCES movies.movie (movie_id),
  CONSTRAINT fk_mcr_per FOREIGN KEY (person_id) REFERENCES movies.person (person_id)
);


INSERT INTO movies.movie_crew (movie_id, person_id, department_id, job) VALUES
(285,120,1,'Director of Photography'),
(285,1704,2,'Director'),
(285,770,3,'Producer'),
(285,1705,4,'Screenplay'),
(285,1706,4,'Screenplay'),
(285,1721,5,'Editor'),
(285,1722,5,'Editor'),
(285,947,6,'Original Music Composer'),
(285,2444,3,'Executive Producer'),
(285,2445,3,'Producer'),
(285,2446,3,'Producer'),
(285,2447,3,'Producer'),
(285,2448,3,'Producer'),
(285,2215,3,'Casting'),
(285,1226,7,'Production Design'),
(285,553,7,'Art Direction'),
(285,3311,3,'Casting'),
(285,4032,7,'Set Decoration'),
(285,4033,8,'Costume Design'),
(285,4034,8,'Costume Design'),
(285,5132,6,'Music Supervisor'),
(285,146439,7,'Conceptual Design'),
(285,406204,8,'Makeup Department Head'),
(285,1259516,9,'Stunts'),
(285,1336716,9,'CGI Supervisor'),
(285,1344278,2,'Script Supervisor'),
(285,1368867,9,'Special Effects Coordinator'),
(285,1368884,6,'Music Editor'),
(285,1395290,2,'Script Supervisor'),
(285,1399327,6,'Music Editor'),
(285,1400738,2,'Script Supervisor'),
(285,1534197,6,'Music Editor'),
(559,6410,3,'Casting'),
(559,10570,3,'Executive Producer'),
(559,7623,4,'Screenplay'),
(559,7623,2,'Director'),
(559,7624,4,'Author'),
(559,7624,3,'Executive Producer'),
(559,7625,4,'Author'),
(559,7712,5,'Editor'),
(559,7627,3,'Producer'),
(559,7626,3,'Producer'),
(559,11411,7,'Production Design'),
(559,11386,8,'Costume Design'),
(559,7630,4,'Screenplay'),
(559,10850,3,'Executive Producer'),
(559,9341,1,'Director of Photography'),
(559,7628,3,'Producer'),
(559,7629,4,'Screenplay'),
(559,19155,6,'Original Music Composer'),
(559,19156,3,'Casting'),
(559,13304,7,'Production Design'),
(559,19157,7,'Set Decoration'),
(559,19158,8,'Costume Design'),
(559,12770,3,'Unit Production Manager'),
(559,13586,7,'Art Direction'),
(559,14349,7,'Art Direction'),
(559,38939,3,'Production Manager'),
(559,66689,7,'Art Direction'),
(559,963355,7,'Art Direction'),
(559,1172443,1,'Still Photographer'),
(559,1227450,3,'Casting Assistant'),
(559,1339433,3,'Production Coordinator'),
(559,1339436,7,'Set Designer'),
(559,1339468,2,'Script Supervisor'),
(559,1357047,7,'Set Designer'),
(559,1360094,7,'Set Designer'),
(559,1377133,1,'Still Photographer'),
(559,1378224,7,'Set Designer'),
(559,1386908,7,'Set Designer'),
(559,1392895,7,'Set Designer'),
(559,1393226,3,'Production Coordinator'),
(559,1395435,7,'Set Designer'),
(559,1400065,7,'Set Designer'),
(559,1451676,9,'Visual Effects Editor'),
(559,1533708,3,'Production Supervisor'),
(559,1553559,3,'Production Coordinator'),
(559,1614178,7,'Set Designer'),
(559,1648111,3,'Location Manager'),
(559,1684384,3,'Location Manager'),
(559,1735078,3,'Casting Assistant'),
(559,1735079,3,'Casting Assistant'),
(559,1781374,3,'Casting Assistant'),
(559,1781376,3,'Casting Assistant'),
(559,1781378,3,'Casting Associate'),
(559,1781379,7,'Location Scout'),
(559,1781381,7,'Title Designer'),
(559,1781382,3,'Production Coordinator'),
(767,2423,1,'Director of Photography'),
(767,5331,7,'Set Decoration'),
(767,5491,7,'Production Design'),
(767,10966,4,'Novel'),
(767,10967,4,'Screenplay'),
(767,10968,3,'Producer'),
(767,10710,7,'Supervising Art Director'),
(767,11225,7,'Art Direction'),
(767,11227,8,'Costume Design'),
(767,11295,3,'Casting'),
(767,11296,7,'Art Direction'),
(767,11343,2,'Director'),
(767,11344,6,'Original Music Composer'),
(767,11345,5,'Editor'),
(767,65614,3,'Producer'),
(767,89320,3,'Producer'),
(767,41289,3,'Executive Producer'),
(767,89383,7,'Art Direction'),
(767,89384,7,'Art Direction'),
(767,89385,7,'Art Direction'),
(767,89386,7,'Art Direction'),
(767,1389548,2,'Script Supervisor'),
(767,1393448,1,'Still Photographer'),
(767,1408843,5,'First Assistant Editor'),
(767,1473175,5,'First Assistant Editor'),
(767,1551777,8,'Assistant Costume Designer'),
(767,1568519,6,'Production Sound Mixer'),
(1452,3276,3,'Casting'),
(1452,3805,3,'Producer'),
(1452,13192,3,'Production Manager'),
(1452,10953,3,'Producer'),
(1452,9032,2,'Director'),
(1452,9032,3,'Producer'),
(1452,9032,4,'Story'),
(1452,9039,5,'Editor'),
(1452,9039,6,'Original Music Composer'),
(1452,9040,1,'Director of Photography'),
(1452,11012,4,'Screenplay'),
(1452,11012,4,'Story'),
(1452,20007,4,'Characters'),
(1452,20008,4,'Characters'),
(1452,21697,3,'Executive Producer'),
(1452,54211,3,'Executive Producer'),
(1452,54212,3,'Executive Producer'),
(1452,11017,5,'Editor'),
(1452,60245,3,'Executive Producer'),
(1452,61624,3,'Casting'),
(1452,11013,4,'Screenplay'),
(1452,11013,4,'Story'),
(1452,1121617,3,'Co-Producer'),
(1452,1271644,7,'Production Design'),
(58,120,1,'Director of Photography'),
(58,1704,2,'Director'),
(58,770,3,'Producer'),
(58,1705,4,'Screenplay'),
(58,1705,4,'Author'),
(58,1706,4,'Screenplay'),
(58,1706,4,'Author'),
(58,1721,5,'Editor'),
(58,1722,5,'Editor'),
(58,947,6,'Original Music Composer'),
(58,2443,3,'Executive Producer'),
(58,2444,3,'Executive Producer'),
(58,2445,3,'Executive Producer'),
(58,2446,3,'Executive Producer'),
(58,2447,3,'Producer'),
(58,2448,3,'Producer'),
(58,2215,3,'Casting'),
(58,1226,7,'Production Design'),
(58,146439,7,'Conceptual Design'),
(58,406204,8,'Makeup Department Head'),
(58,1368867,10,'Special Effects Supervisor'),
(58,1424894,8,'Hairstylist'),
(58,1454884,10,'Visual Effects'),
(2454,1326,3,'Casting'),
(2454,2073,3,'Casting'),
(2454,4854,3,'Associate Producer'),
(2454,4856,3,'Associate Producer'),
(2454,5162,3,'Producer'),
(2454,5524,4,'Screenplay'),
(2454,5524,2,'Director'),
(2454,5524,3,'Producer'),
(2454,5525,4,'Novel'),
(2454,5541,3,'Producer'),
(2454,5542,5,'Editor'),
(2454,5543,3,'Co-Producer'),
(2454,5544,3,'Executive Producer'),
(2454,5545,3,'Co-Producer'),
(2454,5547,7,'Production Design'),
(2454,5548,7,'Set Decoration'),
(2454,5549,8,'Costume Design'),
(2454,5551,4,'Screenplay'),
(2454,5552,4,'Screenplay'),
(2454,5553,6,'Original Music Composer'),
(2454,8677,1,'Director of Photography'),
(2454,9420,7,'Art Direction'),
(2454,12579,1,'Still Photographer'),
(2454,33931,9,'Second Unit Cinematographer'),
(2454,25137,3,'Casting'),
(2454,25729,3,'Casting'),
(2454,29609,7,'Art Direction'),
(2454,37299,7,'Art Direction'),
(2454,37301,7,'Supervising Art Director'),
(2454,71577,7,'Art Direction'),
(2454,71579,7,'Art Direction'),
(2454,77730,7,'Art Direction'),
(2454,132596,7,'Art Direction'),
(2454,132648,8,'Set Costumer'),
(2454,213665,3,'Associate Producer'),
(2454,962164,7,'Art Direction'),
(2454,979175,9,'Second Unit Cinematographer'),
(2454,1014915,3,'Casting Associate'),
(2454,1037310,1,'Camera Operator'),
(2454,1117945,3,'Line Producer'),
(2454,1117946,3,'Line Producer'),
(2454,1117947,5,'Editor'),
(2454,1323281,8,'Costume Supervisor'),
(2454,1327838,9,'Armorer'),
(2454,1334420,7,'Art Direction'),
(2454,1337411,6,'Music Editor'),
(2454,1389541,11,'Gaffer'),
(2454,1390382,6,'Music Editor'),
(2454,1391730,1,'Still Photographer'),
(2454,1392245,1,'Still Photographer'),
(2454,1393282,7,'Art Department Coordinator'),
(2454,1394072,1,'Steadicam Operator'),
(2454,1394073,1,'Camera Operator'),
(2454,1394117,7,'Art Department Coordinator'),
(2454,1398935,11,'Gaffer'),
(2454,1401803,10,'Visual Effects Supervisor'),
(2454,1404739,1,'Helicopter Camera'),
(2454,1405219,6,'Music Editor'),
(2454,1405241,1,'Helicopter Camera'),
(2454,1408834,11,'Rigging Gaffer'),
(2454,1412990,1,'Camera Operator'),
(2454,1417999,8,'Set Costumer'),
(2454,1425500,1,'Camera Operator'),
(2454,1425503,11,'Gaffer'),
(2454,1430496,1,'Still Photographer'),
(2454,1447503,10,'Modeling'),
(2454,1447518,9,'Stunts'),
(2454,1447524,7,'Conceptual Design'),
(2454,1452991,10,'Animation'),
(2454,1455486,2,'Assistant Director'),
(2454,1459657,6,'Orchestrator'),
(2454,1460588,9,'Special Effects'),
(2454,1477203,3,'Associate Producer'),
(2454,1483583,2,'Script Supervisor'),
(2454,1515651,6,'Orchestrator'),
(2454,1554878,7,'Art Department Coordinator'),
(2454,1554879,9,'Armorer'),
(2454,1554883,8,'Costume Supervisor'),
(2454,1554884,8,'Set Costumer'),
(2454,1554885,8,'Set Costumer'),
(2454,1554886,6,'Orchestrator'),
(2454,1554887,11,'Gaffer'),
(2454,1554889,1,'Underwater Camera'),
(1865,120,1,'Director of Photography'),
(1865,770,3,'Producer'),
(1865,1705,4,'Screenplay'),
(1865,1706,4,'Screenplay'),
(1865,1706,3,'Executive Producer');

SELECT job, COUNT(*) AS num_crew_members
FROM movies.movie_crew WHERE movie_id = 285 GROUP BY job;

SELECT person_id
FROM movies.movie_crew WHERE movie_id = 285 GROUP BY person_id HAVING COUNT(*) > 1;

SELECT person_id, job 
FROM movies.movie_crew WHERE movie_id = 285;

SELECT person_id, COUNT(*) AS total_credits
FROM movies.movie_crew
GROUP BY person_id
ORDER BY total_credits DESC
LIMIT 1;

SELECT AVG(crew_count) AS average_crew_per_movie
FROM (SELECT movie_id, COUNT(*) AS crew_count FROM movies.movie_crew GROUP BY movie_id) AS crew_counts;

SELECT person_id
FROM movies.movie_crew
WHERE job IN ('Director', 'Screenwriter')
GROUP BY person_id
HAVING COUNT(DISTINCT job) = 2;

SELECT * FROM movies.movie_crew WHERE department_id = 3;
